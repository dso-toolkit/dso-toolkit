{% set localId = generateLocalId(prefix, id) %}

{% set errorTextId = 'errorTextId_' + localId %}
{% set infoTextId = 'infoTextId_' + localId %}

{% if errorText %}
  {% set ariaDescribedBy = ((ariaDescribedBy + ' ') if ariaDescribedBy) + errorTextId %}
{% endif %}
{% if infoText and static %}
  {% set ariaDescribedBy = ((ariaDescribedBy + ' ') if ariaDescribedBy) + infoTextId %}
{% endif %}

<fieldset {{ className('form-group dso-files', [state, 'dso-' + state], [required, 'dso-required']) }}>
  <legend class="sr-only">{{ label }}</legend>
  <div class="dso-label-container">
    <label for="{{ localId }}" class="control-label" aria-hidden="true">
      {{ label }}
    </label>
    {% if infoText and not static %}
      {% render '@info-button', {infoOpen: infoOpen, infoButtonLabel: infoButtonLabel} %}
    {% endif %}
    {% if infoOpen %}
      {% render '@info', {infoText: infoText, static: static} %}
    {% endif %}
  </div>
  <div class="dso-field-container">
    <ul class="dso-filelist">
      {% for file in files %}
        {% render '@file-item', {id: localId, filename: file.filename, pos: loop.index0, confidential: file.confidential} %}
      {% endfor %}
    </ul>
    {% if files %}
      {% if files | map('confidential') | includes(true) %}
        <dso-alert status="warning">
          <div class="dso-rich-content">
            <p>U vraagt of wij een document vertrouwelijk willen behandelen. Hiervoor moet u twee dingen doen:</p>
            <ol>
              <li>Voeg ook een publiceerbaar document zonder vertrouwelijke informatie toe.</li>
              <li>Geef per document de reden op als toelichting op het verzoek in de laatste stap van uw aanvraag.</li>
            </ol>
            <p>Er zal worden beoordeeld of uw vraag terecht is. U krijgt hiervan bericht.</p>
          </div>
        </dso-alert>
      {% endif %}
    {% endif %}

    <!-- To use an input type="file" element -->
    <div class="dso-file-upload">
      <input type="file" id="{{ localId }}-file-upload"
        {{ attributes([ariaDescribedBy, 'aria-describedby', ariaDescribedBy]) }}
        {% if disabled %} disabled{% endif %}
        {% if state == "invalid" %} aria-invalid="true"{% endif %}
      />
      <label class="dso-{{ buttonClass }}" for="{{ localId }}-file-upload">
        <dso-icon icon="plus"></dso-icon><span>Document toevoegen</span>
      </label>
    </div>
    {% if errorText %}
      {% render '@error-block', {errorText: errorText, id: errorTextId} %}
    {% endif %}
  </div>

  <!-- Or to trigger the upload using a button element (not recommended) -->
  <!--
    {% render '@button', {label: 'Document toevoegen', modifier: 'dso-tertiary', type: 'button', icon: 'plus'} %}
  -->
</fieldset>
