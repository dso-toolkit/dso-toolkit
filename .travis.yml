language: node_js
node_js:
- '10'
install:
- gem install percy-cli
- npm install
jobs:
  include:
  - name: master branch
    if: branch = master && type = push
    script:
      npm run lint &&
      npm run build &&
      npm run test &&
      mv build dist &&
      percy snapshot --widths "380,780,1024,1280" --snapshots_regex "components\/preview\/((?!--).)+\.html$" dist/library/
  - name: topic branch
    if: branch =~ /^#/ && type = push
    script:
      npm run lint &&
      npm run build &&
      npm run test &&
      mv build dist &&
      rsync -e "ssh -p ${DEPLOY_PORT}" --delete --verbose -r ./dist/library/ ${DEPLOY_USER}@${DEPLOY_HOST}:${DEPLOY_ROOT}/dso-toolkit.nl/www/${TRAVIS_BRANCH/\#/_} &&
      rsync -e "ssh -p ${DEPLOY_PORT}" --delete --verbose -r ./dist/toolkit/ ${DEPLOY_USER}@${DEPLOY_HOST}:${DEPLOY_ROOT}/cdn.dso-toolkit.nl/www/${TRAVIS_BRANCH/\#/_} &&
      ssh -p ${DEPLOY_PORT} ${DEPLOY_USER}@${DEPLOY_HOST} "cd ${DEPLOY_ROOT}/dso-toolkit.nl && node --experimental-modules update-versions.mjs" &&
      percy snapshot --widths "380,780,1024,1280" --snapshots_regex "components\/preview\/((?!--).)+\.html$" dist/library/
before_install:
- openssl aes-256-cbc -K $encrypted_5f33485edc80_key -iv $encrypted_5f33485edc80_iv -in deploy_rsa.enc -out deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 deploy_rsa
- ssh-add deploy_rsa
- cat known_hosts >> ~/.ssh/known_hosts
- echo -e "Host ${DEPLOY_HOST}\n\tCheckHostIP no\n" >> ~/.ssh/config
env:
  global:
  - secure: PMCDx3sU/JkLt+0xAfflOENw45LZz5aR93QUJP55Fyf15bK45/0vetuOUbSFiUm5d81FLWjv5ZO3ZVQYNIU2bdrND+9fWYrZw+H6rtWaToTIEdwclC0+cbQi52xxeUMycxThYYm/p0zXWaznGZmUGtfuaIpkBk4iJ/KrU6jUwRYja2ikV3OxBcKithPnZBuKx4RXuzqoRg6EwDVqBXDbFH7raaN4P+ievNf9Xht8Nkiduhzxg38jecwELVstoDM7ABlWsd7ckUxwp16wMMEGS8ocBHDLFmtBpFwfNFDdd+af3Kv3LHY0lEo6p431SCYu5toEFYP36JpY0mWYRoanqElHjytk01IuUsvfpJlr62ve51PlsW9fhs1+xzfVT6IiWkAmoNQwnvkGBvKk6KSF8GMITbl68RPHceMqUC8eJYH32+znA2/Wh3JAbP/BttevMwajxSk4p+fHwmohfEXCsboOamqwh708D8/oVlBrZ9g94o1M4plsySUoHxEKGnOv1u4J73FXgvv/Hq26LTjvQ1oxBeOnedVUeqxYedk/atIh3D0LENtcWNVFobNsh8EE0QG1Ns9GY1XTdQ4gd+STvMXTmsLh3IqaOpLsjHkHFqtDDy3YiwiN2TOBVUZ8WmNnAEDE+mDJN0KdpNao4mux+spPY1LYTdpKd9Mqpaa+El0=
  - secure: QFBqRpPPyt41GpPYsusyfwp3LAUta0ZYRTj+nR8vXuMLo3ZQcY43R+mSK8xH5oBympyNC/JtWMr5NVCDZMHcCT2dct1xM2GInHMUMoPYW7Al5MT+0WQXVr9hoKXIj4uRL9BlCKtbMXvxyEDWdwc+u8Qy0Eb9ZjapIxNKO0BFcvnrqdzKM7qx9TbLaFKWYzbjlPLyplm9dZrTIkOHw9zZH0k3zrDVxVhj5Hx8vdIGan2aXIoOjC/HoMoG64QRqyi5cF763m24TWI57uM7MChZatO0k8+ogU3CnWeNZCH/DSYb/+0QGX4f9bQemf0f2IYV27lok18s36/9JlivTO8fWV0LeDuJ8a5JjVa9Euy6pjrFzXkYz1QUD0W0rV4PnDQeKbib69te9xMIsK9ILDXcVbEP2DzN6GZlsR6zR7PdEIxiiCByt+EVh3K9gtX2dk9gu6sVQOQztOwUprzZtg9e/9Ktdf9viXri+PLFcE3XL8vDXtykaqqgGXvmHG3NwG8RykouB/xlYCPQavcLMJuP0sWQ3rDlBPGhGiMhvojl2r+pvMPDt8tkE1B2icwZGL54tEYtB3iwgqcbTCQ3X62/EpThKfZXboksbvVsRt/FOmPhTkUGCQwutOzxXEfbH5KrjdFTE+w+n6pmBRVoQFUVTXy1pACQ4N41AwKcPmDsw/g=
  - secure: pw7UOcSpxt27X50JrLhzMtJJfHlAIJfrRHMwayUsB9Z+MWLdFI/hLfgexZTT+bRQb0CNUJJfCwCchUxlWaqN7EEtGiwKMSbeLLuG1RdHxUEdcataVIE9PR7UgZUTCCVwaAc/cwFS60y+SECyRdm1F00RDxb7h35HC1d6qsOYFRkHEFt3nFq2c98SE+BAiUaPKqdiVX5IIYQiPNdVvG9ykFoL7ZyLqbXvpBnQgYr5AE+F1bmSIVHBMjUKFjx0axOp/94ly4dxWtc1RxXJxWX2hNlWUrgX8v889nfzrHFG3grS0r7MWktgASt0//m+PYH+QWpkAhcgvhf7hhW2362cgYpbsc76+vLhh7SY3O7hPgBPVbJCdt3XzKzA0Dny7GJhp8iFh7XRZXOvk+W9yiGU7PjeLEuCvSUh8cLv7e1wKGpBoRbhGTu4mMTo/GQMQmXksvtqeP0/k6onSuO1fM2JVd0RWvohZ1ZO/Jo57NhnL++UwjBxE7hZO+Tasgm8vlGoxVtBkZwx/z2YbF2NwM8X/3GRR2YDyIVeWSmvs+SQQ6RtsjeeoEpOEN8c0V1fyJoFY+d0voiuUcjdGDEoO2cLmRoq86OmZzBmpmex6XeotkMzaswFhYVDT5Go8YAH//fp3bQgdH1l/p9pqLBWjbm8R3+4TSzPmLfZth/NAg1/wKM=
  - secure: B89Pf1ljy8VsVwioivQF5V2QkHfWdkDoqEcM/5Si7kXYI6etVNaqhS832O8P8DeF1QmJhjwgdKH5k7UfAdQTfaknDfLVjcQ0Obllgm9nMdP9rw/TIApHva45g1kxcu1L0eU2bWKpBmVHJf6Cm9OTsC8U7XtL/1NnnLH9N4lryNwWKRW2Wh5w4E5OO9vAoKXab+hQ2N85KanaL02ho1VR70O1AN0xaSt3QzzPJFDXhVVWMAGjaKCTiHaM2ZnCem7HzzKZrA3BJTQfnfHk0dNE0sumI/bi0R+EPH4prbBUJsDUZgoPDLWx/1K8GEV8ZJDnOztMxiK6hRfs/qWXZLKUQMjVVofaVdJilrR1S0gmBRyN9O5eMb7haZfl/IH+YMoIiJiEVMYnWH0ev4bIGZFYr1++OeVQIZjV+UewMj2AP7XKYjcc4BK26hJF0qdAOyLvIxbs+aqYkoBhh8R8Ms+LY3aSeb/NPUc9ct+rRtBv9AiSUBlnpRzVs7aALo56aojeMOYr9KNT0eBRfBbRGYLMx6WhJmCb0UrgDeE7dyv+ka2JzxxZ2Ufw7MIzfdp6H+thuIQRCT5ZwCp5qHLMc7o2YximicwukyIKA12QzX/B+hAVjROhWmei9cPUsayOdvpTBuZN9AaQi8GKRl1C3UOoQ58qnGFzodGzlehD06tie+Q=
